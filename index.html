<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KW Public Records Checklist - Form Filler</title>
    <script src="https://unpkg.com/pdf-lib@1.17.1/dist/pdf-lib.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        
        .header {
            background: #d62828;
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 28px;
            margin-bottom: 5px;
            font-weight: 600;
        }
        
        .header p {
            opacity: 0.9;
            font-size: 14px;
        }
        
        .form-content {
            padding: 40px;
        }
        
        .section {
            margin-bottom: 35px;
            padding-bottom: 35px;
            border-bottom: 2px solid #f0f0f0;
        }
        
        .section:last-child {
            border-bottom: none;
        }
        
        .section-title {
            font-size: 20px;
            font-weight: 600;
            color: #d62828;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 3px solid #d62828;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            font-weight: 500;
            color: #333;
            margin-bottom: 8px;
            font-size: 14px;
        }
        
        input[type="text"],
        textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            font-size: 14px;
            transition: all 0.3s;
            font-family: inherit;
        }
        
        input[type="text"]:focus,
        textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        textarea {
            min-height: 100px;
            resize: vertical;
        }
        
        .checkbox-group {
            display: flex;
            gap: 25px;
            flex-wrap: wrap;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 6px;
        }
        
        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .checkbox-item input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
            accent-color: #667eea;
        }
        
        .checkbox-item label {
            margin: 0;
            cursor: pointer;
            font-weight: normal;
        }
        
        .amount-input {
            display: inline-block;
            width: 120px;
            margin-left: 10px;
        }
        
        .radio-group {
            display: flex;
            gap: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 6px;
        }
        
        .radio-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .radio-item input[type="radio"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
            accent-color: #667eea;
        }
        
        .radio-item label {
            margin: 0;
            cursor: pointer;
            font-weight: normal;
        }
        
        .button-container {
            display: flex;
            gap: 15px;
            justify-content: center;
            padding-top: 30px;
        }
        
        button {
            padding: 15px 40px;
            font-size: 16px;
            font-weight: 600;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
        }
        
        .btn-secondary {
            background: #6c757d;
            color: white;
        }
        
        .btn-secondary:hover {
            background: #5a6268;
            transform: translateY(-2px);
        }
        
        .status {
            text-align: center;
            padding: 15px;
            margin-top: 20px;
            border-radius: 6px;
            font-weight: 500;
            display: none;
        }
        
        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .grid-2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        
        @media (max-width: 768px) {
            .grid-2 {
                grid-template-columns: 1fr;
            }
            
            .checkbox-group,
            .radio-group {
                flex-direction: column;
            }
            
            .form-content {
                padding: 25px;
            }
        }
        
        .info-box {
            background: #e3f2fd;
            border-left: 4px solid #2196f3;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 4px;
        }
        
        .info-box p {
            margin: 0;
            color: #0d47a1;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ðŸ“‹ Public Records Checklist</h1>
            <p>Keller Williams Maine - Digital Form Filler</p>
        </div>
        
        <div class="form-content">
            <div class="info-box">
                <p><strong>Instructions:</strong> Fill out the form below and click "Generate PDF" to create your completed Public Records Checklist. All processing happens in your browser - no data is sent to any server.</p>
            </div>
            
            <form id="prcForm">
                <!-- Property Address Section -->
                <div class="section">
                    <div class="section-title">Property Information</div>
                    <div class="form-group">
                        <label for="propertyAddress">Property Address *</label>
                        <input type="text" id="propertyAddress" name="propertyAddress" required>
                    </div>
                </div>
                
                <!-- Section 1: Assessor's Office -->
                <div class="section">
                    <div class="section-title">1. Assessor's Office</div>
                    
                    <div class="form-group">
                        <label>Tax Exemptions</label>
                        <div class="checkbox-group">
                            <div class="checkbox-item">
                                <input type="checkbox" id="homestead" name="homestead">
                                <label for="homestead">Homestead</label>
                                <input type="text" class="amount-input" id="homesteadAmount" placeholder="$">
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="veterans" name="veterans">
                                <label for="veterans">Veterans</label>
                                <input type="text" class="amount-input" id="veteransAmount" placeholder="$">
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="treeGrowth" name="treeGrowth">
                                <label for="treeGrowth">Tree Growth</label>
                                <input type="text" class="amount-input" id="treeGrowthAmount" placeholder="$">
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="na" name="na">
                                <label for="na">N/A</label>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <div class="checkbox-group">
                            <div class="checkbox-item">
                                <input type="checkbox" id="attachDataCard" name="attachDataCard">
                                <label for="attachDataCard">ATTACH Property Data Card (required)</label>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <div class="checkbox-group">
                            <div class="checkbox-item">
                                <input type="checkbox" id="attachTaxMap" name="attachTaxMap">
                                <label for="attachTaxMap">ATTACH Tax Map (required)</label>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Section 2: Code Enforcement Office -->
                <div class="section">
                    <div class="section-title">2. Code Enforcement Office</div>
                    
                    <div class="form-group">
                        <label for="dateVisited">Date Visited</label>
                        <input type="text" id="dateVisited" name="dateVisited" placeholder="MM/DD/YYYY">
                    </div>
                    
                    <div class="grid-2">
                        <div class="form-group">
                            <label for="currentZone">Current Zoning</label>
                            <input type="text" id="currentZone" name="currentZone">
                        </div>
                        
                        <div class="form-group">
                            <label for="overlay">Zoning Overlay?</label>
                            <input type="text" id="overlay" name="overlay">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>Flood Zone?</label>
                        <div class="radio-group">
                            <div class="radio-item">
                                <input type="radio" id="floodYes" name="floodZone" value="Yes">
                                <label for="floodYes">Yes</label>
                            </div>
                            <div class="radio-item">
                                <input type="radio" id="floodNo" name="floodZone" value="No">
                                <label for="floodNo">No</label>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="zoningConform">Does current use appear to conform to zoning restrictions?</label>
                        <input type="text" id="zoningConform" name="zoningConform">
                    </div>
                    
                    <div class="form-group">
                        <label for="dwellingUnits">Number of legal dwelling units permitted per ordinance?</label>
                        <input type="text" id="dwellingUnits" name="dwellingUnits">
                    </div>
                    
                    <div class="form-group">
                        <label>Septic system located in a shoreland zone?</label>
                        <div class="radio-group">
                            <div class="checkbox-item">
                                <input type="checkbox" id="septicYes" name="septicYes">
                                <label for="septicYes">Yes</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="septicNo" name="septicNo">
                                <label for="septicNo">No</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="septicNA" name="septicNA">
                                <label for="septicNA">N/A</label>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="permitsIssued">Record dates & descriptions of permits issued or code enforcement issues (DO NOT LEAVE BLANK)</label>
                        <textarea id="permitsIssued" name="permitsIssued" placeholder="Enter details here..."></textarea>
                    </div>
                </div>
                
                <!-- Section 3: Submit Documents -->
                <div class="section">
                    <div class="section-title">3. Submit the Following Documents (if applicable)</div>
                    
                    <div class="checkbox-group" style="flex-direction: column; gap: 12px;">
                        <div class="checkbox-item">
                            <input type="checkbox" id="doc1" name="doc1">
                            <label for="doc1">Pertinent code enforcement file documents (from section 2 item 5 above)</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="doc2" name="doc2">
                            <label for="doc2">Zone Overlays (from section 2 item 1 above)</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="doc3" name="doc3">
                            <label for="doc3">Recorded survey (if deed only references a plan to describe the property)</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="doc4" name="doc4">
                            <label for="doc4">Recorded easements, restrictions, covenants or subdivision plan restrictions</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="doc5" name="doc5">
                            <label for="doc5">Association declarations, bylaws, rules/regs</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="doc6" name="doc6">
                            <label for="doc6">Association financial statements</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="doc7" name="doc7">
                            <label for="doc7">Condominium resale certificate or public offering statement</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="doc8" name="doc8">
                            <label for="doc8">Septic Design (HHE 200)</label>
                        </div>
                    </div>
                </div>
                
                <!-- Section 4: Completed By -->
                <div class="section">
                    <div class="section-title">4. Completed By</div>
                    <div class="form-group">
                        <label for="completedBy">Your Name</label>
                        <input type="text" id="completedBy" name="completedBy">
                    </div>
                </div>
                
                <div class="button-container">
                    <button type="button" class="btn-secondary" onclick="resetForm()">Clear Form</button>
                    <button type="submit" class="btn-primary">Generate PDF</button>
                </div>
                
                <div id="status" class="status"></div>
            </form>
        </div>
    </div>
    
    <script>
        const pdfUrl = 'KW_Maine_Public_Records_Checklist.pdf';
        
        document.getElementById('prcForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            await fillPDF();
        });
        
        function resetForm() {
            document.getElementById('prcForm').reset();
            showStatus('Form cleared!', 'success');
            setTimeout(() => hideStatus(), 2000);
        }
        
        function showStatus(message, type) {
            const status = document.getElementById('status');
            status.textContent = message;
            status.className = `status ${type}`;
            status.style.display = 'block';
        }
        
        function hideStatus() {
            const status = document.getElementById('status');
            status.style.display = 'none';
        }
        
        async function fillPDF() {
            try {
                showStatus('Generating PDF...', 'success');
                
                // Load the PDF
                const response = await fetch(pdfUrl);
                const pdfBytes = await response.arrayBuffer();
                
                // Load PDF with pdf-lib
                const { PDFDocument } = PDFLib;
                const pdfDoc = await PDFDocument.load(pdfBytes);
                
                // Get the form
                const form = pdfDoc.getForm();
                
                // Fill all the fields
                const setValue = (fieldName, value) => {
                    try {
                        const field = form.getTextField(fieldName);
                        if (value) field.setText(String(value));
                    } catch (e) {
                        console.warn(`Could not set text field: ${fieldName}`, e);
                    }
                };
                
                const setCheckbox = (fieldName, isChecked) => {
                    try {
                        const field = form.getCheckBox(fieldName);
                        if (isChecked) {
                            field.check();
                        } else {
                            field.uncheck();
                        }
                    } catch (e) {
                        console.warn(`Could not set checkbox: ${fieldName}`, e);
                    }
                };
                
                const setRadio = (fieldName, value) => {
                    try {
                        const field = form.getRadioGroup(fieldName);
                        field.select(value);
                    } catch (e) {
                        console.warn(`Could not set radio: ${fieldName}`, e);
                    }
                };
                
                // Property Address
                setValue('Property Address', document.getElementById('propertyAddress').value);
                
                // Tax Exemptions
                setCheckbox('Homestead', document.getElementById('homestead').checked);
                setCheckbox('Veterans', document.getElementById('veterans').checked);
                setCheckbox('Tree Growth', document.getElementById('treeGrowth').checked);
                setCheckbox('NA', document.getElementById('na').checked);
                
                setValue('Homestead $', document.getElementById('homesteadAmount').value);
                setValue('Veterans $', document.getElementById('veteransAmount').value);
                setValue('Tree Growth $', document.getElementById('treeGrowthAmount').value);
                
                // Attachments
                setCheckbox('undefined', document.getElementById('attachDataCard').checked);
                setCheckbox('undefined_2', document.getElementById('attachTaxMap').checked);
                
                // Code Enforcement
                setValue('DATE VISITED', document.getElementById('dateVisited').value);
                setValue('Current Zone', document.getElementById('currentZone').value);
                setValue('Overlay?', document.getElementById('overlay').value);
                
                // Flood Zone Radio - Fixed!
                const floodZoneValue = document.querySelector('input[name="floodZone"]:checked')?.value;
                console.log('Flood Zone selected value:', floodZoneValue);
                
                if (floodZoneValue) {
                    try {
                        const floodField = form.getRadioGroup('Flood Zone');
                        // Don't add the slash - just use 'Yes' or 'No' directly
                        floodField.select(floodZoneValue);
                        console.log('Successfully set Flood Zone to:', floodZoneValue);
                    } catch (e) {
                        console.error('Could not set Flood Zone:', e);
                        console.error('Error details:', e.message);
                    }
                }
                
                setValue('2 Does current use appear to conform to zoning restrictions', 
                         document.getElementById('zoningConform').value);
                setValue('3 Number of legal dwelling units permitted per ordinance', 
                         document.getElementById('dwellingUnits').value);
                
                // Septic checkboxes
                setCheckbox('undefined_3', document.getElementById('septicYes').checked);
                setCheckbox('undefined_4', document.getElementById('septicNo').checked);
                setCheckbox('undefined_5', document.getElementById('septicNA').checked);
                
                setValue('5 Record dates  descriptions of permits issued or code enforcement issues if any DO NOT LEAVE BLANK', 
                         document.getElementById('permitsIssued').value);
                
                // Document checkboxes
                setCheckbox('toggle_12', document.getElementById('doc1').checked);
                setCheckbox('undefined_6', document.getElementById('doc2').checked);
                setCheckbox('undefined_7', document.getElementById('doc3').checked);
                setCheckbox('undefined_8', document.getElementById('doc4').checked);
                setCheckbox('undefined_9', document.getElementById('doc5').checked);
                setCheckbox('undefined_10', document.getElementById('doc6').checked);
                setCheckbox('undefined_11', document.getElementById('doc7').checked);
                setCheckbox('undefined_12', document.getElementById('doc8').checked);
                
                // Completed By
                setValue('4 COMPLETED BY', document.getElementById('completedBy').value);
                
                // Flatten the form (optional - makes fields non-editable)
                // form.flatten();
                
                // Save the PDF
                const pdfBytesOutput = await pdfDoc.save();
                
                // Download the PDF
                const blob = new Blob([pdfBytesOutput], { type: 'application/pdf' });
                const link = document.createElement('a');
                link.href = URL.createObjectURL(blob);
                
                const propertyAddr = document.getElementById('propertyAddress').value || 'Property';
                const filename = `PRC_${propertyAddr.replace(/[^a-zA-Z0-9]/g, '_')}_${new Date().toISOString().split('T')[0]}.pdf`;
                link.download = filename;
                
                link.click();
                
                showStatus('PDF generated successfully! Check your downloads.', 'success');
                setTimeout(() => hideStatus(), 5000);
                
            } catch (error) {
                console.error('Error generating PDF:', error);
                showStatus('Error generating PDF: ' + error.message, 'error');
            }
        }
    </script>
</body>
</html>
